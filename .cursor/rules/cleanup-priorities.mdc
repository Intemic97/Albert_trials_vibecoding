---
description: Plan de limpieza y prioridades para el proyecto - Febrero 2026
globs: ["**/*.tsx", "**/*.ts"]
alwaysApply: false
---

# Plan de Limpieza y Prioridades

## Estado Actual del C√≥digo (Actualizado 2026-02-04)

### Limpieza Completada ‚úÖ

- [x] Eliminado `WorkflowsRefactored.example.tsx` (381 l√≠neas)
- [x] Eliminados 3 archivos de documentaci√≥n duplicada (MIGRATION_*.md)
- [x] Limpiados console.logs de desarrollo
- [x] Verificados lints (sin errores)

### Problema Principal: `Workflows.tsx`

| M√©trica | Valor | Objetivo |
|---------|-------|----------|
| L√≠neas actuales | **11,541** | < 500 |
| useState hooks | ~170 | 0 (usar stores) |
| Componentes inline | ~20 | 0 |

Este archivo es el **tech debt m√°s cr√≠tico** del proyecto.

### Arquitectura Actual vs Deseada

```
ACTUAL (Monolito):                    DESEADO (Modular):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Workflows.tsx     ‚îÇ               ‚îÇ WorkflowEditor   ‚îÇ (~500 l√≠neas)
‚îÇ   11,547 l√≠neas     ‚îÇ      ‚Üí        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   170 useState      ‚îÇ               ‚îÇ Zustand Stores   ‚îÇ
‚îÇ   Todo mezclado     ‚îÇ               ‚îÇ + Hooks modulares‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Prioridades de Refactorizaci√≥n

### üî¥ URGENTE (Sprint actual)

#### 1. Completar migraci√≥n de ejecuci√≥n de nodos
**Archivos:** `components/workflows/hooks/useWorkflowExecution.ts`

El sistema de ejecuci√≥n actual en `Workflows.tsx` (l√≠neas ~3404-3480) debe moverse a un hook dedicado que:
- Ejecute nodos secuencialmente seg√∫n el DAG
- Actualice estado via WebSocket
- Soporte cancelaci√≥n (ya implementado backend)

**Esfuerzo:** 2-3 d√≠as

#### 2. Extraer configuraci√≥n de nodos del monolito
**Archivos:** `components/workflows/modals/` (ya existen muchos)

El c√≥digo de configuraci√≥n en `Workflows.tsx` (l√≠neas ~4200-8000) son ~4000 l√≠neas que ya tienen equivalentes en `modals/`. Necesitamos:
- Conectar los modales existentes con `nodeConfigStore`
- Eliminar c√≥digo duplicado de `Workflows.tsx`

**Esfuerzo:** 1-2 d√≠as

#### 3. Unificar las dos versiones
**Rutas:** `/workflows` (original) vs `/workflows-v2` (nueva)

Actualmente hay DOS versiones corriendo. Debemos:
- Validar que `/workflows-v2` tiene feature parity
- Hacer switch gradual
- Deprecar la versi√≥n original

**Esfuerzo:** 3-5 d√≠as

### üü° ALTA (Pr√≥ximo sprint)

#### 4. Limpiar archivos de ejemplo/documentaci√≥n
Archivos que pueden eliminarse o moverse:
- `WorkflowsRefactored.example.tsx` ‚Üí Mover a docs o eliminar
- `MIGRATION_*.md` ‚Üí Consolidar en cursor rules
- Comentarios TODO antiguos

#### 5. Optimizar re-renders
El canvas actual re-renderiza demasiado. Implementar:
- `React.memo` en nodos
- Selectores espec√≠ficos de Zustand
- `useMemo`/`useCallback` consistentes

#### 6. Tests unitarios para stores
- `workflowStore.test.ts`
- `nodeConfigStore.test.ts`
- Tests de hooks de canvas

### üü¢ MEDIA (Backlog)

#### 7. Separar l√≥gica de negocio
Crear `utils/workflowEngine.ts`:
- Validaci√≥n de conexiones
- C√°lculo de orden de ejecuci√≥n (topological sort)
- Serializaci√≥n/deserializaci√≥n

#### 8. Documentaci√≥n inline
- JSDoc en funciones p√∫blicas
- Storybook para componentes de UI

## Archivos a NO tocar (estables)

| Archivo | Raz√≥n |
|---------|-------|
| `stores/workflowStore.ts` | Funcionando bien |
| `stores/nodeConfigStore.ts` | Funcionando bien |
| `hooks/useExecutionProgress.ts` | Reci√©n actualizado |
| `components/workflows/modals/*` | Ya modulares |

## Archivos a eliminar eventualmente

| Archivo | Reemplazo |
|---------|-----------|
| `Workflows.tsx` (11,547 l√≠neas) | `WorkflowEditor.tsx` |
| `WorkflowsRefactored.example.tsx` | Documentaci√≥n |

## M√©tricas de √âxito

| M√©trica | Actual | Meta |
|---------|--------|------|
| Archivo m√°s grande | 11,547 l√≠neas | < 800 l√≠neas |
| Tiempo de carga inicial | ~2s | < 500ms |
| Re-renders por interacci√≥n | ~15 | < 5 |
| Cobertura de tests | 0% | > 60% |

## Comando para verificar progreso

```bash
# Ver tama√±o de archivos principales
wc -l components/Workflows.tsx components/workflows/WorkflowEditor.tsx

# Buscar useState en Workflows.tsx
grep -c "useState" components/Workflows.tsx

# Buscar TODO pendientes
grep -r "TODO" components/workflows --include="*.tsx" | wc -l
```

---

**√öltima actualizaci√≥n:** 2026-02-04
**Responsable:** Equipo de desarrollo
